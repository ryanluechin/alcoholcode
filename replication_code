#packages

library(tidyr)
library(dplyr)
library(modelsummary)
library(psych)

# Drop specific states
df <-alcohol_data %>% filter(!(state %in% c(15, 54)))

#arange data for time series analysis
df <- df %>% arrange(state, year)

#create new variables

df <- df %>%
  mutate(
    excise_price = 1 + beer_tax / 100,
    salestax_price = 1 + salestax / 100,
    beer_per_cap = c_beer / population,
    
    ln_excise_price = log(excise_price),
    ln_salestax_price = log(salestax_price),
    ln_cons_beer = log(beer_per_cap),
    ln_population = log(population),
    ln_income = log(st_income / population),
    ln_unemp_rate = log(st_uemp_rate)
  ) %>%
  arrange(state, year) %>%
  group_by(state) %>%
  mutate(
    dln_population = ln_population - lag(ln_population),
    dln_income = ln_income - lag(ln_income),
    dln_unemp_rate = ln_unemp_rate - lag(ln_unemp_rate),
    dln_excise_price = ln_excise_price - lag(ln_excise_price),
    dln_salestax_price = ln_salestax_price - lag(ln_salestax_price),
    dln_cons_beer = ln_cons_beer - lag(ln_cons_beer)
  ) %>%
  ungroup()


#table 5 summary statistics chart generation

df <- df %>%
  mutate(beer_per_cap = beer_per_cap * 24 / 2.25) %>%
  mutate(
    policy_change = d_driving_age != 0 | d_bac_teen_02 != 0 | d_lower_limit != 0 | d_bac_10 != 0 | d_bac_08 != 0 | d_admin_license_rev != 0,
    policy_change = ifelse(is.na(d_driving_age), NA, policy_change),
    d21 = da >= 21
  )

summary_stats <- df %>%
  select(beer_per_cap, btax_dollars, beer_tax, salestax, d21, policy_change) %>%
  describe()

print(summary_stats)



  
   
